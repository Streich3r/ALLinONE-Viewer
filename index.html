<!DOCTYPE html>
<html lang="de">
<head>
<link rel="icon" type="image/png" href="icon-512.png">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Offline Document Viewer</title>
<style>
body { font-family: sans-serif; padding: 10px; }
button { margin: 5px; padding: 10px; font-size: 1rem; }
#viewer { margin-top: 20px; border: 1px solid #ccc; padding: 10px; overflow-x:auto; }
canvas { max-width: 100%; height: auto; }

.slide { 
    border: 1px solid #999; 
    margin: 10px auto; 
    padding: 20px; 
    background: #fff; 
    width: 90%; 
    max-width: 600px; 
    min-height: 300px; 
    box-shadow: 2px 2px 10px rgba(0,0,0,0.2);
    display: none;
}
.slide p { margin: 5px 0; font-size: 1rem; }

.nav-buttons { text-align: center; margin-top: 10px; }
.nav-buttons button { padding: 10px 20px; font-size: 1rem; }
</style>
</head>
<body>
<h2>Offline Document Viewer</h2>

<!-- Buttons für Dateiauswahl -->
<input type="file" id="pdfFile" accept=".pdf" style="display:none"/>
<button onclick="document.getElementById('pdfFile').click()">PDF öffnen</button>

<input type="file" id="docxFile" accept=".docx" style="display:none"/>
<button onclick="document.getElementById('docxFile').click()">Word öffnen</button>

<input type="file" id="xlsxFile" accept=".xlsx" style="display:none"/>
<button onclick="document.getElementById('xlsxFile').click()">Excel öffnen</button>

<input type="file" id="pptxFile" accept=".pptx" style="display:none"/>
<button onclick="document.getElementById('pptxFile').click()">PowerPoint öffnen</button>

<input type="file" id="odfFile" accept=".odt,.ods,.odp" style="display:none"/>
<button onclick="document.getElementById('odfFile').click()">ODF öffnen</button>

<div id="viewer"></div>
<div class="nav-buttons" id="pptNav" style="display:none;">
    <button id="prevSlide">← Zurück</button>
    <button id="nextSlide">Weiter →</button>
</div>

<!-- Bibliotheken -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.12.313/pdf.min.js"></script>
<script src="https://unpkg.com/docx-preview@1.0.1/dist/docx-preview.min.js"></script>
<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://webodf.org/webodf.js"></script>

<script>
const viewer = document.getElementById('viewer');
const pptNav = document.getElementById('pptNav');
let slides = [];
let currentSlide = 0;

/* --- PDF --- */
document.getElementById('pdfFile').addEventListener('change', async e => {
    const file = e.target.files[0];
    const data = await file.arrayBuffer();
    const pdf = await pdfjsLib.getDocument({data}).promise;
    const page = await pdf.getPage(1);
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    const viewport = page.getViewport({scale: 1.5});
    canvas.width = viewport.width;
    canvas.height = viewport.height;
    await page.render({canvasContext: ctx, viewport}).promise;
    viewer.innerHTML = '';
    viewer.appendChild(canvas);
    pptNav.style.display = 'none';
});

/* --- DOCX --- */
document.getElementById('docxFile').addEventListener('change', async e => {
    const file = e.target.files[0];
    const arrayBuffer = await file.arrayBuffer();
    const docx = new DocxPreview(arrayBuffer);
    viewer.innerHTML = '';
    docx.render(viewer);
    pptNav.style.display = 'none';
});

/* --- XLSX --- */
document.getElementById('xlsxFile').addEventListener('change', async e => {
    const file = e.target.files[0];
    const data = await file.arrayBuffer();
    const workbook = XLSX.read(data, {type:"array"});
    const sheet = workbook.Sheets[workbook.SheetNames[0]];
    viewer.innerHTML = XLSX.utils.sheet_to_html(sheet);
    pptNav.style.display = 'none';
});

/* --- PPTX mit Folien-Navigation --- */
document.getElementById('pptxFile').addEventListener('change', async e => {
    const file = e.target.files[0];
    const arrayBuffer = await file.arrayBuffer();
    const zip = await JSZip.loadAsync(arrayBuffer);
    viewer.innerHTML = '';
    slides = [];

    const slideFiles = Object.keys(zip.files).filter(f => f.startsWith('ppt/slides/slide') && f.endsWith('.xml'));
    for (let slideFile of slideFiles) {
        const slideData = await zip.files[slideFile].async('text');
        const texts = [...slideData.matchAll(/<a:t>(.*?)<\/a:t>/g)].map(m=>m[1]);
        const slideDiv = document.createElement('div');
        slideDiv.className = 'slide';
        slideDiv.innerHTML = texts.map(t=>`<p>${t}</p>`).join('');
        viewer.appendChild(slideDiv);
        slides.push(slideDiv);
    }

    currentSlide = 0;
    showSlide(currentSlide);
    pptNav.style.display = 'block';
});

function showSlide(index) {
    slides.forEach((s,i)=> s.style.display = i===index ? 'block' : 'none');
}

document.getElementById('prevSlide').addEventListener('click', () => {
    if (currentSlide > 0) currentSlide--;
    showSlide(currentSlide);
});

document.getElementById('nextSlide').addEventListener('click', () => {
    if (currentSlide < slides.length - 1) currentSlide++;
    showSlide(currentSlide);
});

/* --- ODF (ODT/ODS/ODP) --- */
document.getElementById('odfFile').addEventListener('change', async e => {
    const file = e.target.files[0];
    const reader = new FileReader();
    reader.onload = () => {
        viewer.innerHTML = '';
        const odfCanvas = new odf.OdfCanvas(viewer);
        odfCanvas.load(reader.result);
        pptNav.style.display = 'none';
    };
    reader.readAsArrayBuffer(file);
});
</script>
</body>
</html>
